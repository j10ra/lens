<mxfile host="65bd71144e">
    <diagram name="LENS Architecture" id="1">
        <mxGraphModel dx="791" dy="651" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="800" pageHeight="900" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>

                <mxCell id="2" value="AI Agent&#xa;(Claude Code, Cursor, etc.)" style="rounded=1;whiteSpace=wrap;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=13;verticalAlign=middle;spacingTop=2;spacingBottom=2;" parent="1" vertex="1">
                    <mxGeometry x="220" y="20" width="360" height="50" as="geometry"/>
                </mxCell>

                <mxCell id="3" value="CLI  (lens command)&#xa;login | context | repo | index | status | daemon | dashboard | init" style="rounded=1;whiteSpace=wrap;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;verticalAlign=middle;" parent="1" vertex="1">
                    <mxGeometry x="220" y="110" width="360" height="50" as="geometry"/>
                </mxCell>

                <mxCell id="4" value="MCP stdio" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#6c8ebf;fontSize=10;exitX=0.25;exitY=1;entryX=0.25;entryY=0;" parent="1" source="2" target="5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="60" value="HTTP :4111" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#9673a6;fontSize=10;" parent="1" source="3" target="5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="61" value="HTTP POST /context" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#6c8ebf;fontSize=10;exitX=0.75;exitY=1;entryX=0.75;entryY=0;" parent="1" source="2" target="5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="62" value="HTTPS&#xa;(API key auth)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#b85450;fontSize=9;fontStyle=2;" parent="1" source="17" target="20" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="555" y="500"/>
                            <mxPoint x="400" y="500"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="63" value="Drizzle ORM" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#666666;fontSize=10;" parent="1" source="20" target="33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="64" value="webhooks" style="rounded=1;strokeColor=#999999;dashed=1;fontSize=9;" parent="1" source="36" target="20" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="5" value="Layer 2: Daemon  (Hono :4111)" style="swimlane;startSize=28;fillColor=#fff2cc;strokeColor=#d6b656;rounded=1;fontStyle=1;fontSize=12;collapsible=0;" parent="1" vertex="1">
                    <mxGeometry x="60" y="200" width="680" height="270" as="geometry"/>
                </mxCell>

                <mxCell id="6" value="REST API" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" parent="5" vertex="1">
                    <mxGeometry x="20" y="40" width="100" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="7" value="MCP Server" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" parent="5" vertex="1">
                    <mxGeometry x="140" y="40" width="100" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="Dashboard SPA" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" parent="5" vertex="1">
                    <mxGeometry x="260" y="40" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="SSE Buses&#xa;repo | auth" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="5" vertex="1">
                    <mxGeometry x="390" y="40" width="100" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="Request Logger&#xa;(SQLite)" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="5" vertex="1">
                    <mxGeometry x="510" y="40" width="110" height="40" as="geometry"/>
                </mxCell>

                <mxCell id="42" style="rounded=1;strokeColor=#d6b656;" parent="5" source="6" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="43" style="rounded=1;strokeColor=#d6b656;" parent="5" source="7" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="11" value="Layer 1: Engine  (SQLite + Drizzle)" style="swimlane;startSize=24;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;fontStyle=1;fontSize=11;collapsible=0;" parent="5" vertex="1">
                    <mxGeometry x="20" y="100" width="380" height="155" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="Indexer&#xa;diff scan, chunk,&#xa;metadata, imports,&#xa;git history" style="rounded=1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;verticalAlign=middle;" parent="11" vertex="1">
                    <mxGeometry x="10" y="32" width="110" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="13" value="Context Builder&#xa;TF-IDF, co-change,&#xa;semantic boost,&#xa;structural enrich" style="rounded=1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;verticalAlign=middle;" parent="11" vertex="1">
                    <mxGeometry x="135" y="32" width="115" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="14" value="SQLite&#xa;repos | chunks&#xa;file_metadata&#xa;file_imports | file_stats&#xa;file_cochanges&#xa;request_logs&#xa;telemetry_events&#xa;usage_counters" style="shape=cylinder3;whiteSpace=wrap;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;verticalAlign=middle;" parent="11" vertex="1">
                    <mxGeometry x="265" y="25" width="105" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="15" style="rounded=1;strokeColor=#82b366;" parent="11" source="12" target="14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="16" style="rounded=1;strokeColor=#82b366;" parent="11" source="13" target="14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="17" value="Cloud Proxy&#xa;(authenticated)&#xa;embed | chat&#xa;usage | telemetry" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" parent="5" vertex="1">
                    <mxGeometry x="430" y="100" width="130" height="75" as="geometry"/>
                </mxCell>
                <mxCell id="18" value="File Watcher&#xa;(chokidar)" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="5" vertex="1">
                    <mxGeometry x="580" y="100" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="Timers&#xa;quota 5m | telem 60s&#xa;log prune 1h" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" parent="5" vertex="1">
                    <mxGeometry x="430" y="190" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="65" value="Quota Cache&#xa;(5m TTL)" style="rounded=1;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" parent="5" vertex="1">
                    <mxGeometry x="570" y="155" width="100" height="35" as="geometry"/>
                </mxCell>

                <mxCell id="20" value="Layer 3: Cloud  (Hono API + TanStack Start SSR)" style="swimlane;startSize=28;fillColor=#f8cecc;strokeColor=#b85450;rounded=1;fontStyle=1;fontSize=12;collapsible=0;" parent="1" vertex="1">
                    <mxGeometry x="60" y="530" width="680" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="Auth&#xa;OAuth" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="20" y="40" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="API Keys&#xa;SHA-256" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="105" y="40" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="Usage&#xa;Counters" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="190" y="40" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="Proxy&#xa;embed | chat" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="275" y="40" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="25" value="Billing&#xa;Stripe" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="370" y="40" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="Quota&#xa;Middleware" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="455" y="40" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="Admin Panel&#xa;(TanStack Start SSR)" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="550" y="40" width="115" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="66" value="Telemetry&#xa;Ingestion" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="20" vertex="1">
                    <mxGeometry x="20" y="95" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="Rate Limit&#xa;(KV, 60 tok)" style="rounded=1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" parent="20" vertex="1">
                    <mxGeometry x="115" y="95" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="29" value="Voyage AI&#xa;(embeddings)" style="rounded=1;whiteSpace=wrap;fillColor=#e6e6e6;strokeColor=#999999;fontSize=10;dashed=1;" parent="20" vertex="1">
                    <mxGeometry x="275" y="120" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="OpenRouter&#xa;(LLM chat)" style="rounded=1;whiteSpace=wrap;fillColor=#e6e6e6;strokeColor=#999999;fontSize=10;dashed=1;" parent="20" vertex="1">
                    <mxGeometry x="380" y="120" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="31" style="rounded=1;strokeColor=#999999;dashed=1;" parent="20" source="24" target="29" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="32" style="rounded=1;strokeColor=#999999;dashed=1;" parent="20" source="24" target="30" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>

                <mxCell id="33" value="Supabase (Postgres + Auth + RLS)&#xa;api_keys | subscriptions | usage_daily&#xa;plan_quotas | telemetry_events" style="shape=cylinder3;whiteSpace=wrap;boundedLbl=1;backgroundOutline=1;size=12;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=11;verticalAlign=middle;spacingTop=4;" parent="1" vertex="1">
                    <mxGeometry x="200" y="760" width="400" height="80" as="geometry"/>
                </mxCell>

                <mxCell id="36" value="Stripe" style="rounded=1;whiteSpace=wrap;fillColor=#e6e6e6;strokeColor=#999999;fontSize=11;dashed=1;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry y="600" width="45" height="30" as="geometry"/>
                </mxCell>

                <mxCell id="44" value="Color Legend" style="swimlane;startSize=20;fillColor=none;strokeColor=#999999;fontSize=10;collapsible=0;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry y="20" width="170" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="45" value="Agent / Client" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;" parent="44" vertex="1">
                    <mxGeometry x="10" y="25" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="46" value="CLI" style="rounded=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" parent="44" vertex="1">
                    <mxGeometry x="10" y="50" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="47" value="Daemon (L2)" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" parent="44" vertex="1">
                    <mxGeometry x="10" y="75" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="48" value="Engine (L1)" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" parent="44" vertex="1">
                    <mxGeometry x="90" y="25" width="70" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="49" value="Cloud (L3)" style="rounded=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" parent="44" vertex="1">
                    <mxGeometry x="90" y="50" width="70" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="50" value="External" style="rounded=1;fillColor=#e6e6e6;strokeColor=#999999;fontSize=9;dashed=1;" parent="44" vertex="1">
                    <mxGeometry x="90" y="75" width="70" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="Database" style="shape=cylinder3;size=5;fillColor=#f5f5f5;strokeColor=#666666;fontSize=9;" parent="44" vertex="1">
                    <mxGeometry x="30" y="98" width="60" height="25" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>
